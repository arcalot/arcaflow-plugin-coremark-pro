# CoreMark®-PRO Python Plugin

This plugin runs the [CoreMark®-PRO](https://github.com/eembc/coremark-pro) 
*certify-all* workloads and returns the results in a machine-readable format.

## Build the container

The plugin is intended to be run as a container. The provided [Dockerfile](Dockerfile)
will handle the build parameters.

```bash
podman build . -t arcaflow-plugin-coremark-pro
```

## Run the benchmarks

### Tuning the iterations

In order to adjust the run time for each of the benchmarks to a target number of
seconds, each benchmark must have its iterations adjusted individually. The plugin
provides a `tune-iterations` step to calculate the target number of iterations as
appropriate for the target system under test. The `tune-iterations` step accepts a
parameter `target_run_time` as integer seconds (default is 10).

*NOTE -- If you are going to pass the output of the `tune-iterations` step to the 
`certify-all` step in a workflow, you should include in the input to this step all of 
the parameters for the `certify-all` step so that the output object generated is
complete.*

```bash
cat inputs/tune-iterations-example.yaml | podman run -i arcaflow-plugin-coremark-pro -f -
```

### Running certify-all

The required input parameters are `contexts` and `workers` as integers. An optional
object parameter `iterations` may be provided to set the number of iterations for each
benchmark individually.


```bash
cat inputs/certify-all-example.yaml | podman run -i arcaflow-plugin-coremark-pro -f -
```

Or as a one-liner:
```bash
echo '{"contexts": 1, "workers": 1}' | podman run -i arcaflow-plugin-coremark-pro -f -
```

### Sample workflow

A sample Arcaflow workflow file is provided to demonstrate how to connect the output
of the `tune-iterations` step to the input of the `certify-all` step. This will require
and [Arcaflow engine binary](https://github.com/arcalot/arcaflow-engine/releases)
version of v0.17.0-beta2 or greater.

```bash
cd sample_workflow
arcaflow -config config.yaml -input input.yaml -context .
```

# Autogenerated Input/Output Documentation by Arcaflow-Docsgen Below

<!-- Autogenerated documentation by arcaflow-docsgen -->
## certify-all (`certify-all`)

Runs all of the nine tests, collects their output scores, and processes them to generate the final CoreMark-PRO score

### Input

<table><tbody>
<tr><th>Type:</th><td><code>scope</code></td><tr><th>Root object:</th><td>CertifyAllParams</td></tr>
<tr><th>Properties</th><td><details><summary>contexts (<code>int</code>)</summary>
                <table><tbody><tr><th>Name:</th><td>Contexts</td></tr><tr><th>Description:</th><td width="500">Number of contexts per benchmark</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>int</code></td>
</tbody></table>
            </details><details><summary>workers (<code>int</code>)</summary>
                <table><tbody><tr><th>Name:</th><td>Workers</td></tr><tr><th>Description:</th><td width="500">Number of workers per benchmark</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>int</code></td>
</tbody></table>
            </details></td></tr>
<tr><td colspan="2"><details><summary><strong>Objects</strong></summary><details><summary>CertifyAllParams (<code>object</code>)</summary>
            <table><tbody><tr><th>Type:</th><td><code>object</code></td><tr><th>Properties</th><td><details><summary>contexts (<code>int</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Contexts</td></tr><tr><th>Description:</th><td width="500">Number of contexts per benchmark</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>int</code></td>
</tbody></table>
        </details><details><summary>workers (<code>int</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Workers</td></tr><tr><th>Description:</th><td width="500">Number of workers per benchmark</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>int</code></td>
</tbody></table>
        </details></td></tr>
</tbody></table>
        </details></details></td></tr>
</tbody></table>

### Outputs


#### error

<table><tbody>
<tr><th>Type:</th><td><code>scope</code></td><tr><th>Root object:</th><td>ErrorOutput</td></tr>
<tr><th>Properties</th><td><details><summary>error (<code>string</code>)</summary>
                <table><tbody><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>string</code></td></tbody></table>
            </details></td></tr>
<tr><td colspan="2"><details><summary><strong>Objects</strong></summary><details><summary>ErrorOutput (<code>object</code>)</summary>
            <table><tbody><tr><th>Type:</th><td><code>object</code></td><tr><th>Properties</th><td><details><summary>error (<code>string</code>)</summary>
        <table><tbody><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>string</code></td></tbody></table>
        </details></td></tr>
</tbody></table>
        </details></details></td></tr>
</tbody></table>

#### success

<table><tbody>
<tr><th>Type:</th><td><code>scope</code></td><tr><th>Root object:</th><td>SuccessOutput</td></tr>
<tr><th>Properties</th><td><details><summary>coremark_pro_params (<code>reference[CertifyAllParams]</code>)</summary>
                <table><tbody><tr><th>Name:</th><td>Test Params</td></tr><tr><th>Description:</th><td width="500">The paramaters applied to the CoreMark®-PRO tests</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>reference[CertifyAllParams]</code></td><tr><th>Referenced object:</th><td>CertifyAllParams</td></tr></tbody></table>
            </details><details><summary>coremark_pro_results (<code>reference[CertifyAllResult]</code>)</summary>
                <table><tbody><tr><th>Name:</th><td>Test Results</td></tr><tr><th>Description:</th><td width="500">The results of the CoreMark®-PRO</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>reference[CertifyAllResult]</code></td><tr><th>Referenced object:</th><td>CertifyAllResult</td></tr></tbody></table>
            </details></td></tr>
<tr><td colspan="2"><details><summary><strong>Objects</strong></summary><details><summary>CertifyAllItem (<code>object</code>)</summary>
            <table><tbody><tr><th>Type:</th><td><code>object</code></td><tr><th>Properties</th><td><details><summary>MultiCore (<code>float</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>MultiCore</td></tr><tr><th>Description:</th><td width="500">Workload retult - Multi-Core (iter/s)</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>float</code></td>
</tbody></table>
        </details><details><summary>Scaling (<code>float</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Scaling</td></tr><tr><th>Description:</th><td width="500">Workload retult - Scaling</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>float</code></td>
</tbody></table>
        </details><details><summary>SingleCore (<code>float</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>SingleCore</td></tr><tr><th>Description:</th><td width="500">Workload retult - Single-Core (iter/s)</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>float</code></td>
</tbody></table>
        </details></td></tr>
</tbody></table>
        </details><details><summary>CertifyAllParams (<code>object</code>)</summary>
            <table><tbody><tr><th>Type:</th><td><code>object</code></td><tr><th>Properties</th><td><details><summary>contexts (<code>int</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Contexts</td></tr><tr><th>Description:</th><td width="500">Number of contexts per benchmark</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>int</code></td>
</tbody></table>
        </details><details><summary>workers (<code>int</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Workers</td></tr><tr><th>Description:</th><td width="500">Number of workers per benchmark</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>int</code></td>
</tbody></table>
        </details></td></tr>
</tbody></table>
        </details><details><summary>CertifyAllResult (<code>object</code>)</summary>
            <table><tbody><tr><th>Type:</th><td><code>object</code></td><tr><th>Properties</th><td><details><summary>CoreMark-PRO (<code>reference[CertifyAllItem]</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>CoreMark PRO</td></tr><tr><th>Description:</th><td width="500">Benchmark: CoreMark-PRO</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>reference[CertifyAllItem]</code></td><tr><th>Referenced object:</th><td>CertifyAllItem</td></tr></tbody></table>
        </details><details><summary>cjpeg-rose7-preset (<code>reference[CertifyAllItem]</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>CJPEG Rose7 Preset</td></tr><tr><th>Description:</th><td width="500">Workload: CJPEG Rose7 Preset</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>reference[CertifyAllItem]</code></td><tr><th>Referenced object:</th><td>CertifyAllItem</td></tr></tbody></table>
        </details><details><summary>core (<code>reference[CertifyAllItem]</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Core</td></tr><tr><th>Description:</th><td width="500">Workload: Core</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>reference[CertifyAllItem]</code></td><tr><th>Referenced object:</th><td>CertifyAllItem</td></tr></tbody></table>
        </details><details><summary>linear_alg-mid-100x100-sp (<code>reference[CertifyAllItem]</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Linear Alg Mid 100x100 SP</td></tr><tr><th>Description:</th><td width="500">Workload: Linear Alg Mid 100x100 SP</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>reference[CertifyAllItem]</code></td><tr><th>Referenced object:</th><td>CertifyAllItem</td></tr></tbody></table>
        </details><details><summary>loops-all-mid-10k-sp (<code>reference[CertifyAllItem]</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Loops All Mid 10k SP</td></tr><tr><th>Description:</th><td width="500">Workload: Loops All Mid 10k SP</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>reference[CertifyAllItem]</code></td><tr><th>Referenced object:</th><td>CertifyAllItem</td></tr></tbody></table>
        </details><details><summary>nnet_test (<code>reference[CertifyAllItem]</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>NNet Test</td></tr><tr><th>Description:</th><td width="500">Workload: NNet Test</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>reference[CertifyAllItem]</code></td><tr><th>Referenced object:</th><td>CertifyAllItem</td></tr></tbody></table>
        </details><details><summary>parser-125k (<code>reference[CertifyAllItem]</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Parser 125k</td></tr><tr><th>Description:</th><td width="500">Workload: Parser 125k</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>reference[CertifyAllItem]</code></td><tr><th>Referenced object:</th><td>CertifyAllItem</td></tr></tbody></table>
        </details><details><summary>radix2-big-64k (<code>reference[CertifyAllItem]</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Radix2 Big 64k</td></tr><tr><th>Description:</th><td width="500">Workload: Radix2 Big 64k</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>reference[CertifyAllItem]</code></td><tr><th>Referenced object:</th><td>CertifyAllItem</td></tr></tbody></table>
        </details><details><summary>sha-test (<code>reference[CertifyAllItem]</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>SHA Test</td></tr><tr><th>Description:</th><td width="500">Workload: SHA Test</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>reference[CertifyAllItem]</code></td><tr><th>Referenced object:</th><td>CertifyAllItem</td></tr></tbody></table>
        </details><details><summary>zip-test (<code>reference[CertifyAllItem]</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>ZIP Test</td></tr><tr><th>Description:</th><td width="500">Workload: ZIP Test</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>reference[CertifyAllItem]</code></td><tr><th>Referenced object:</th><td>CertifyAllItem</td></tr></tbody></table>
        </details></td></tr>
</tbody></table>
        </details><details><summary>SuccessOutput (<code>object</code>)</summary>
            <table><tbody><tr><th>Type:</th><td><code>object</code></td><tr><th>Properties</th><td><details><summary>coremark_pro_params (<code>reference[CertifyAllParams]</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Test Params</td></tr><tr><th>Description:</th><td width="500">The paramaters applied to the CoreMark®-PRO tests</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>reference[CertifyAllParams]</code></td><tr><th>Referenced object:</th><td>CertifyAllParams</td></tr></tbody></table>
        </details><details><summary>coremark_pro_results (<code>reference[CertifyAllResult]</code>)</summary>
        <table><tbody><tr><th>Name:</th><td>Test Results</td></tr><tr><th>Description:</th><td width="500">The results of the CoreMark®-PRO</td></tr><tr><th>Required:</th><td>Yes</td></tr><tr><th>Type:</th><td><code>reference[CertifyAllResult]</code></td><tr><th>Referenced object:</th><td>CertifyAllResult</td></tr></tbody></table>
        </details></td></tr>
</tbody></table>
        </details></details></td></tr>
</tbody></table>
<!-- End of autogenerated documentation -->
